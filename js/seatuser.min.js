/*! learn-canvas - v0.0.0 2013-12-10 
 Copyright (c) 2013 AndyYou Licensed  */ 
var mousewheel=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel",padding=[10,10,10,10],stageWidth=480,stageHeight=320,seatWidth=20,seatHeight=20,seatRow=10,seatColumn=24,seatTotalWidth=seatWidth*seatColumn,seatTotalHeight=seatHeight*seatRow,scale=1,defaultScale=seatTotalWidth>=seatTotalHeight?stageWidth/seatTotalWidth*.9:stageHeight/seatTotalHeight*.9,defaultOffsetX=(stageWidth-seatTotalWidth*defaultScale)/2,minScale=.3,maxScale=2.5,hoverSeatId="",stage=new Kinetic.Stage({container:"container",width:stageWidth,height:stageHeight,draggable:!0,scale:defaultScale,x:defaultOffsetX});stage.getContainer().addEventListener("mousedown",function(){document.body.style.cursor="all-scroll"}),stage.getContainer().addEventListener("mouseup",function(){document.body.style.cursor="default"});var layer=new Kinetic.Layer,layerTooltip=new Kinetic.Layer,rectArena=new Kinetic.Rect({x:padding[1],y:stage.getHeight()-80-padding[2],width:seatTotalWidth-padding[1]-padding[3],height:80,fill:"rgba(0, 0, 0, 0.1)",cornerRadius:5}),txtArena=new Kinetic.Text({x:stage.getWidth()/2,y:stage.getHeight()/3*2+50,text:"表演區域",fontSize:20,fill:"rgba(0, 0, 0, 0.3)"});txtArena.setOffset({x:txtArena.getWidth()/2}),layer.add(rectArena),layer.add(txtArena);for(var seats=[{x:150,y:10,id:"10-1",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:170,y:10,id:"10-2",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:190,y:10,id:"10-3",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:210,y:10,id:"10-4",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:230,y:10,id:"10-5",sold:!0,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:250,y:10,id:"10-6",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:270,y:10,id:"10-7",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:290,y:10,id:"10-8",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:310,y:10,id:"10-9",sold:!0,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:330,y:10,id:"10-10",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:10,y:30,id:"9-1",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:30,y:30,id:"9-2",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:50,y:30,id:"9-3",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:70,y:30,id:"9-4",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:90,y:30,id:"9-5",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:150,y:30,id:"9-6",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:170,y:30,id:"9-7",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:190,y:30,id:"9-8",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:210,y:30,id:"9-9",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:230,y:30,id:"9-10",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:250,y:30,id:"9-11",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:270,y:30,id:"9-12",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:290,y:30,id:"9-13",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:310,y:30,id:"9-14",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:330,y:30,id:"9-15",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:390,y:30,id:"9-17",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:410,y:30,id:"9-18",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:430,y:30,id:"9-19",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:450,y:30,id:"9-20",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:470,y:30,id:"9-21",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:10,y:50,id:"8-1",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:30,y:50,id:"8-2",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:50,y:50,id:"8-3",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:70,y:50,id:"8-4",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:90,y:50,id:"8-5",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:150,y:50,id:"8-6",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:170,y:50,id:"8-7",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:190,y:50,id:"8-8",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:210,y:50,id:"8-9",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:230,y:50,id:"8-10",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:250,y:50,id:"8-11",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:270,y:50,id:"8-12",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:290,y:50,id:"8-13",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:310,y:50,id:"8-14",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:330,y:50,id:"8-15",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:390,y:50,id:"8-17",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:410,y:50,id:"8-18",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:430,y:50,id:"8-19",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:450,y:50,id:"8-20",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:470,y:50,id:"8-21",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:10,y:70,id:"7-1",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:30,y:70,id:"7-2",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:50,y:70,id:"7-3",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:70,y:70,id:"7-4",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:90,y:70,id:"7-5",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:150,y:70,id:"7-6",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:170,y:70,id:"7-7",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:190,y:70,id:"7-8",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:210,y:70,id:"7-9",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:230,y:70,id:"7-10",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:250,y:70,id:"7-11",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:270,y:70,id:"7-12",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:290,y:70,id:"7-13",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:310,y:70,id:"7-14",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:330,y:70,id:"7-15",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:390,y:70,id:"7-17",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:410,y:70,id:"7-18",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:430,y:70,id:"7-19",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:450,y:70,id:"7-20",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:470,y:70,id:"7-21",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:10,y:90,id:"6-1",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:30,y:90,id:"6-2",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:50,y:90,id:"6-3",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:70,y:90,id:"6-4",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:90,y:90,id:"6-5",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:150,y:90,id:"6-6",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:170,y:90,id:"6-7",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:190,y:90,id:"6-8",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:210,y:90,id:"6-9",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:230,y:90,id:"6-10",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:250,y:90,id:"6-11",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:270,y:90,id:"6-12",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:290,y:90,id:"6-13",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:310,y:90,id:"6-14",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:330,y:90,id:"6-15",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:390,y:90,id:"6-17",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:410,y:90,id:"6-18",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:430,y:90,id:"6-19",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:450,y:90,id:"6-20",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:470,y:90,id:"6-21",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:10,y:110,id:"5-1",sold:!1,price:100,name:"劉德華-一般票",color:"251, 85, 34, 0.8"},{x:30,y:110,id:"5-2",sold:!1,price:100,name:"劉德華-一般票",color:"251, 85, 34, 0.8"},{x:50,y:110,id:"5-3",sold:!1,price:100,name:"劉德華-一般票",color:"251, 85, 34, 0.8"},{x:70,y:110,id:"5-4",sold:!1,price:100,name:"劉德華-一般票",color:"251, 85, 34, 0.8"},{x:90,y:110,id:"5-5",sold:!1,price:100,name:"劉德華-一般票",color:"251, 85, 34, 0.8"},{x:150,y:110,id:"5-6",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:170,y:110,id:"5-7",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:190,y:110,id:"5-8",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:210,y:110,id:"5-9",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:230,y:110,id:"5-10",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:250,y:110,id:"5-11",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:270,y:110,id:"5-12",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:290,y:110,id:"5-13",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:310,y:110,id:"5-14",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:330,y:110,id:"5-15",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:390,y:110,id:"5-17",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:410,y:110,id:"5-18",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:430,y:110,id:"5-19",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:450,y:110,id:"5-20",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:470,y:110,id:"5-21",sold:!1,price:100,name:"劉德華-一般票",color:"11, 182, 114, 0.8"},{x:10,y:130,id:"4-1",sold:!1,price:100,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:30,y:130,id:"4-2",sold:!1,price:100,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:50,y:130,id:"4-3",sold:!1,price:100,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:70,y:130,id:"4-4",sold:!1,price:100,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:90,y:130,id:"4-5",sold:!1,price:100,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:150,y:130,id:"4-6",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:170,y:130,id:"4-7",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:190,y:130,id:"4-8",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:210,y:130,id:"4-9",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:230,y:130,id:"4-10",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:250,y:130,id:"4-11",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:270,y:130,id:"4-12",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:290,y:130,id:"4-13",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:310,y:130,id:"4-14",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:330,y:130,id:"4-15",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:390,y:130,id:"4-17",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:410,y:130,id:"4-18",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:430,y:130,id:"4-19",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:450,y:130,id:"4-20",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:470,y:130,id:"4-21",sold:!1,price:100,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:10,y:150,id:"3-1",sold:!1,price:700,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:30,y:150,id:"3-2",sold:!1,price:700,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:50,y:150,id:"3-3",sold:!0,price:700,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:70,y:150,id:"3-4",sold:!1,price:700,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:90,y:150,id:"3-5",sold:!1,price:700,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:150,y:150,id:"3-6",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:170,y:150,id:"3-7",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:190,y:150,id:"3-8",sold:!0,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:210,y:150,id:"3-9",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:230,y:150,id:"3-10",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:250,y:150,id:"3-11",sold:!0,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:270,y:150,id:"3-12",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:290,y:150,id:"3-13",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:310,y:150,id:"3-14",sold:!0,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:330,y:150,id:"3-15",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:390,y:150,id:"3-17",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:410,y:150,id:"3-18",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:430,y:150,id:"3-19",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:450,y:150,id:"3-20",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:470,y:150,id:"3-21",sold:!1,price:700,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:10,y:170,id:"2-1",sold:!1,price:800,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:30,y:170,id:"2-2",sold:!1,price:800,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:50,y:170,id:"2-3",sold:!1,price:800,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:70,y:170,id:"2-4",sold:!1,price:800,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:90,y:170,id:"2-5",sold:!1,price:800,name:"劉德華-VIP",color:"251, 85, 34,  0.8"},{x:150,y:170,id:"2-6",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:170,y:170,id:"2-7",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:190,y:170,id:"2-8",sold:!0,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:210,y:170,id:"2-9",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:230,y:170,id:"2-10",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:250,y:170,id:"2-11",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:270,y:170,id:"2-12",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:290,y:170,id:"2-13",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:310,y:170,id:"2-14",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:330,y:170,id:"2-15",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:390,y:170,id:"2-17",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:410,y:170,id:"2-18",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:430,y:170,id:"2-19",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:450,y:170,id:"2-20",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:470,y:170,id:"2-21",sold:!1,price:800,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:10,y:190,id:"1-1",sold:!1,price:900,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:30,y:190,id:"1-2",sold:!1,price:900,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:50,y:190,id:"1-3",sold:!0,price:900,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:70,y:190,id:"1-4",sold:!1,price:900,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:90,y:190,id:"1-5",sold:!1,price:900,name:"劉德華-VIP",color:"251, 85, 34, 0.8"},{x:150,y:190,id:"1-6",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:170,y:190,id:"1-7",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:190,y:190,id:"1-8",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:210,y:190,id:"1-9",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:230,y:190,id:"1-10",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:250,y:190,id:"1-11",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:270,y:190,id:"1-12",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:290,y:190,id:"1-13",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:310,y:190,id:"1-14",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:330,y:190,id:"1-15",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:390,y:190,id:"1-17",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:410,y:190,id:"1-18",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:430,y:190,id:"1-19",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:450,y:190,id:"1-20",sold:!0,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"},{x:470,y:190,id:"1-21",sold:!1,price:900,name:"劉德華-VIP",color:"11, 182, 114, 0.8"}],tickets=[],i=0;i<seats.length;i++){var seat=new Kinetic.Circle({id:seats[i].id,name:seats[i].name,sold:seats[i].sold,price:seats[i].price,color:seats[i].color,x:seats[i].x,y:seats[i].y+25,radius:6,fill:seats[i].sold?"rgba(100, 100, 100, 0.2)":"rgba("+seats[i].color+")",checked:!1});seat.on("mouseover",function(){if(!this.attrs.sold)if(this.attrs.checked)hoverSeatId="";else{hoverSeatId=this.attrs.id,tooltip.setPosition(this.attrs.x*scale,(this.attrs.y-5)*scale),tooltip.getText().setText(this.attrs.id+"\n"+this.attrs.name+"\nNTD "+this.attrs.price),tooltip.show(),layerTooltip.batchDraw();for(var rgba=this.attrs.color.split(","),i=0;i<rgba.length;i++)rgba[i]=parseInt(rgba[i]);rgba[3]=1;var masstone=rgba.indexOf(Math.max.apply(Math,rgba.slice(0,3)));rgba[masstone]=255,this.attrs.fill="rgba("+rgba.join(",")+")",layer.batchDraw()}}),seat.on("mouseout",function(){this.attrs.sold||this.attrs.checked||(hoverSeatId="",tooltip.hide(),layerTooltip.batchDraw(),this.attrs.fill="rgba("+this.attrs.color+")",this.attrs.stroke=null,layer.batchDraw())}),seat.on("click",function(){if(!this.attrs.sold){if(!this.attrs.checked&&tickets.length<10)this.attrs.fill="rgba("+this.attrs.color+")",this.attrs.stroke="#333",this.attrs.checked=!0,tickets.push({id:this.attrs.id,name:this.attrs.name,price:this.attrs.price});else{this.attrs.fill="rgba(11, 182, 114, 0.8)",this.attrs.stroke=null,this.attrs.checked=!1;for(var i=0;i<tickets.length;i++)tickets[i].id===this.attrs.id&&tickets.splice(i,1)}layer.draw()}}),layer.add(seat)}var tooltip=new Kinetic.Label({opacity:.75,visible:!1,listening:!1});tooltip.add(new Kinetic.Tag({fill:"black",pointerDirection:"down",pointerWidth:10,pointerHeight:10,lineJoin:"round",shadowOpacity:.5})),tooltip.add(new Kinetic.Text({text:"",fontFamily:"Calibri",fontSize:13,padding:5,fill:"white"})),layerTooltip.add(tooltip),stage.add(layer),stage.add(layerTooltip),document.attachEvent?stage.getContainer().attachEvent("on"+mousewheel,function(e){if(hoverSeatId){var seat=stage.find("#"+hoverSeatId)[0];seat.attrs.sold||seat.attrs.checked||(tooltip.hide(),layerTooltip.draw(),seat.attrs.fill="rgba("+seat.attrs.color+")",seat.attrs.stroke=null)}Zoom(e)}):document.addEventListener&&stage.getContainer().addEventListener(mousewheel,function(e){if(hoverSeatId){var seat=stage.find("#"+hoverSeatId)[0];seat.attrs.sold||seat.attrs.checked||(tooltip.hide(),layerTooltip.draw(),seat.attrs.fill="rgba("+seat.attrs.color+")",seat.attrs.stroke=null)}Zoom(e)});var SetSelectionArea=function(){if(dragging&&!inhere){inhere=!0;var mousepos=(layer.getCanvas(),stage.getPointerPosition()),x=mousepos.x,y=mousepos.y;if(selectionExists){var height=0,width=0,newX=0,newY=0;newX=x>initX?initX:x,newY=y>initY?initY:y;var height=Math.abs(Math.abs(y)-Math.abs(initY)),width=Math.abs(Math.abs(x)-Math.abs(initX));rectSelection.setHeight(height),rectSelection.setWidth(width),rectSelection.setX(newX),rectSelection.setY(newY),layerBackground.batchDraw()}else initX=x,initY=y,rectSelection=new Kinetic.Rect({x:initX,y:initY,height:1,width:1,fill:"rgba(0, 0, 0, 0.2)"}),layerBackground.add(rectSelection),layerBackground.batchDraw(),selectionExists=!0}inhere=!1},Zoom=function(e){var e=window.event||e;delta=e.detail?-120*e.detail:e.wheelDelta,0!==delta&&(e.preventDefault?e.preventDefault():e.returnValue=!1);var nowScale;if(nowScale=delta>0?scale+Math.abs(delta/640):scale-Math.abs(delta/640),nowScale>minScale&&maxScale>nowScale){var dom=document.getElementById("container"),canvaspos=GetPosition(dom),pos=stage.getAbsolutePosition(),pageX=0,pageY=0;e.pageX||e.pageY?(pageX=e.pageX,pageY=e.pageY):(e.clientX||e.clientY)&&(pageX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,pageY=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);var smallCalc=(stage.getPointerPosition(),(pageX-pos.x-canvaspos.x)/scale),smallCalcY=(pageY-pos.y-canvaspos.y)/scale,endCalc=pageX-canvaspos.x-nowScale*smallCalc,endCalcY=pageY-canvaspos.y-nowScale*smallCalcY;scale=nowScale,stage.setPosition(endCalc,endCalcY),layer.setScale(nowScale),layer.batchDraw()}},GetPosition=function(el){for(var lx=0,ly=0;null!=el;lx+=el.offsetLeft,ly+=el.offsetTop,el=el.offsetParent);return{x:lx,y:ly}};$(function(){var anim;$("#zoomResize").click(function(){anim&&anim.isRunning()||(anim=new Kinetic.Animation(function(frame){var pos=stage.getAbsolutePosition();if(1==scale&&pos.x==defaultOffsetX&&0==pos.y)frame.time=0,this.stop();else{var frameOfLayer=(scale-1)*(frame.time/500);scale>1&&1>=scale-frameOfLayer||1>scale&&scale+frameOfLayer>=1?scale=1:scale-=frameOfLayer;var frameOfStageX=(pos.x-defaultOffsetX)*(frame.time/500),frameOfStageY=(pos.y-0)*(frame.time/500);frameOfStageX=pos.x>defaultOffsetX&&pos.x-frameOfStageX<=defaultOffsetX||pos.x<defaultOffsetX&&pos.x+frameOfStageX>=defaultOffsetX?defaultOffsetX:pos.x-frameOfStageX,frameOfStageY=pos.y>0&&pos.y-frameOfStageY<=0||pos.y<0&&pos.y+frameOfStageY>=0?0:pos.y-frameOfStageY,stage.setPosition(frameOfStageX,frameOfStageY),layer.setScale(scale)}},layer),anim.start())}),$("#zoomIn").click(function(){if(!anim||!anim.isRunning()){var endScale=scale+.1875>=maxScale?maxScale:scale+.1875,widthScale=(1.1875*stage.getWidth()-stage.getWidth())/2,heightScale=(1.1875*stage.getHeight()-stage.getHeight())/2;anim=new Kinetic.Animation(function(frame){if(scale==endScale)frame.time=0,this.stop();else{var frameOfLayer=.1875*.1;scale+frameOfLayer>=endScale?scale=endScale:(scale+=frameOfLayer,scale=Math.round(1e3*scale)/1e3);var pos=stage.getAbsolutePosition(),frameOfStageX=pos.x-.1*widthScale,frameOfStageY=pos.y-.1*heightScale;layer.setScale(scale),stage.setPosition(frameOfStageX,frameOfStageY)}},layer),anim.start()}}),$("#zoomOut").click(function(){if(!anim||!anim.isRunning()){var endScale=minScale>=scale-.1875?minScale:scale-.1875,widthScale=(1.1875*stage.getWidth()-stage.getWidth())/2,heightScale=(1.1875*stage.getHeight()-stage.getHeight())/2;anim=new Kinetic.Animation(function(frame){if(scale==endScale)frame.time=0,this.stop();else{var frameOfLayer=.1875*.1;endScale>=scale-frameOfLayer?scale=endScale:(scale-=frameOfLayer,scale=Math.round(1e3*scale)/1e3);var pos=stage.getAbsolutePosition(),frameOfStageX=pos.x+.1*widthScale,frameOfStageY=pos.y+.1*heightScale;layer.setScale(scale),stage.setPosition(frameOfStageX,frameOfStageY)}},layer),anim.start()}})});